#### H264视频编码

H264压缩比：约1/100

RBG是每个像素占3个Byte，YUV420每个像素占1.5个Byte

YUV420分辨率 640*480帧率 15，55296k bit；建议码流500kpbs 千比特每秒，压缩比1/100

码流参考值：声网：https://docs.agora.io/cn，设置视频属性

**GOP**：group of picture，GOP中帧与帧之间的差别小，按相关性进行分组

**I/P/B帧：**

I帧 intraframe frame，关键帧，采用帧内压缩技术。**IDR帧属于I帧**，GOP组中的第一帧被称为I帧

P帧 forward Predicted frame，向前参考帧。压缩时，只参考前面已经处理的帧，采用帧间压缩技术。它占I帧的一半大小

B帧 Bidirectionally predicted frame，双向参考帧。压缩时，既参考前面已经处理的帧，也参考后面的帧，帧间压缩技术。它占I帧1/4大小

IDR帧：解码器立即刷新帧。每当遇到IDR帧时，解码器就会清空解码器参考buffer中的内容；每个GOP中的第一帧就是IDR帧；IDR帧是一种特殊的I帧

SPS与PPS，成对出现：

- Sequence Parameter Set，序列参数集，作用于一连串连续的视频图像。如seq_parameter_set_id、帧数及POC picture order count的约束、参考帧数目、解码图像尺寸和帧场编码模式选择标识符等。

- Picture Parameter Set，图像参数集，作用于视频序列中的图像。如pic_parameter_set_id、墒编码模式选择标识、片组数目、初始量化参数和去方块滤波系数调整标识等



#### H264压缩技术

1. 帧内压缩，解决的是空域数据冗余问题，有损压缩
2. 帧间压缩，解决的是时域数据冗余问题，有损压缩
3. 整数离散余弦变换DCT，将空间上的相关性变为频域上无关的数据然后进行量化，无损压缩
4. CABAC压缩，无损压缩

宏块

1. 宏块是视频压缩操作的基本单元
2. 无论是帧内压缩还是帧间压缩，它们都以宏块为单位

帧内压缩的理论：

1. 相邻像素差别不大，所以可以进行宏块预测
2. 人对亮度的敏感度超过色度
3. YUV很容易将亮度和色度分开

帧间压缩原理：

1. GOP：一组强相关的帧
2. 参考帧
3. 运动估计（宏块匹配+运动矢量）
4. 运动补偿（解码）

视频花屏原因：如果GOP分组中有帧丢失，会造成解码端的图像发生错误，这会出现马赛克花屏；

- 为了避免花屏问题的发生，当发现有帧丢失时，就丢弃GOP内的所有帧，直到下一个IDR帧重新刷新图像。

- I帧是按照帧周期来的，需要一个比较长的时间周期，如果在下一个I帧来之前不显示后来的图像，那么视频就静止不动了，这就是出现了所谓的**卡顿现象**。



#### 无损压缩：

1. DCT变换
2. VLC压缩：使用率高的字符用短码
3. CABAC压缩



#### H264码流

H264码流分层

1. NAL层：Network Abstraction Layer，视频数据网络抽象层
2. VCL层：Video Coding Layer，视频数据编码层

码流基本概念

1. SODB：原始数据比特流，长度不一定是8的倍数，故需要补齐。它是由VCL层产生的。
2. RBSP：SODB + trailing bits 算法是如果SODB最后一个字节不对齐，则补1和多个0
3. NALU：NAL Header(1B) + RBSP
