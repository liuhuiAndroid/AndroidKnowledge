### 国密

国家商用密码，简称商密，拼音缩写时SM。

为什么要使用国密？发展自己的加密算法，比使用美国公布的加密算法安全，防止数学后门；摆脱国外技术控制的必然举措；提升标准国际话语权必要举措。

SM1 和 SM4 是对称算法，对标 AES；

SM2 是非对称算法，对标 RSA、ECDSA；

SM3 是摘要算法，对标 MD5；

国密SDK：郑州信大捷安信息技术股份有限公司 www.xdja.com

### No.2 

##### 常见的安全威胁

信息安全事故：

CSDN的600万用户数据被泄露：脱裤

需要落实国家信息安全等级保护制度

弱密码：123456

##### 信息安全介绍

基本原则

- 机密性
- 完整性
- 可用性
- 不可否认性

##### 基础知识温习

```
1 byte = 8 bit
1 int = 4 byte = 32 bit = 1 word
1 long = 8 byte = 64 bit = 2 word
1 short/char = 2 byte = 16 bit
```

##### 不可靠通信模型和术语

可能被窃听

可能被篡改

可能有损传输

明文：Plain Text

密文：Cipher Text

密钥：Key

加密：Encrypt

解密：Decrypt

编码：Encode

解码：Decode

##### 古典密码--移位密码和维吉尼亚密码

### No.3 

##### 无处不在的Hash应用

校验文件是否完整

##### 介绍Hash函数和性质

一个函数 H(x) = y 被称为 Hash 函数

随机性、单向性、有效性

常见的 Hash 方法：md5 sha1 sha256 SM3(国密)

##### 密码学Hash的安全性

- 原像困难

  给定 h(x) = y 计算出 x 是困难的

- 第二原像困难

  对任意消息 x 找出另一个消息 x 满足 h(x) =h(x') 是困难的

- 碰撞困难

  要找出两个随机的消息 x 和 x' 使得 h(x) = h(x') 是困难的

##### 详解MD5 SHA1原理

MD5

- 摘要长度 128 bit
- 块大小 512 bit
- 轮计算 4

MD5/SHA1步骤

- 预处理
- 四轮函数

##### Hash计算的一般过程

1. 消息填充和预处理
2. 分块处理
3. 迭代 Hash 函数计算
4. 最终计算，输出摘要值

##### 实战应用-库和硬件支持

OpenSSL 基础库

- 行业基础库
- 开发语言实现

##### 实战应用-openssl等工具演示

OpenSSL 项目、命令

- Libcrypto 密码算法、证书
- Libsll SSL 连接

```shell
# 查看版本
openssl version -a
# 查看摘要算法
openssl list -digest-commands
# 使用 sha256 计算文件 hash 值
openssl dgst -sha256 file...
# 获取网络流进行 sha1 计算
curl -s https://www.baidu.com/licence/ | openssl dgst -sha1
```

#####  实战应用-Hash在Redis中的应用

Redis keyHashSlot 方法使用 hash 计算确定键值分布

##### 实战应用-Hash在比特币中的应用

PoW 机制伪代码：

Sha256(上一个Hash值，其他信息，随机数) < 目标值

##### 实战应用-Hash在Git中的应用

每一次 commit 的 commit id 都有唯一标识

##### 从java.security学习MessageDigest

```java
MessageDigest md = MessageDigest.getInstance("md5");
```

##### 典型Hash应用

- 单向口令文件

  linux 如何保存用户密码

- 一致性校验

- 伪随机数发生器

- 数字货币

#####  安全性问题

hash 碰撞一定存在

禁止 MD5 用在数字安全领域；SHA-1已经被事实上放弃。使用SHA256。

### No.8 密钥交换和数字信任链

##### 密钥交换和数字信任链

Key Exchange & Chain of Trust

##### Diffie-Hellman 密钥交换

DH算法是一种匿名密钥协商方案

##### ECDH 密钥交换

椭圆曲线密钥交换协议

##### 从java.crypto学习 DH

##### 数字信任-公钥基础设施

公钥分发方案：

1. 公开发布，有公开服务商

2. 公钥授权，需要组织登记查询；公钥授权中心

3. 公钥证书：使用证书来交换公钥，而不是管理员

   证书包含公钥，所有者标志，可信第三方签名

公钥基础设施 PKI

X.509 证书

##### 实战应用-操作系统的信任链

##### 实战应用-Openssl应用讲解

pem 格式证书转换成 der 格式证书

```shell
openssl x509 -in ca.pem -inform pem -out ca.der -outform der
```

导入CA到cacerts

指定新的 trustStore

##### 实战应用-java中的信任链

```shell
# 生成密钥
openssl genrsa -out domain.key 2048
# 生成CSR文件，可以交给签名机构签名证书
openssl req -new -key domain.key -out domain.csr
# 开始自签名创建CA
# 生成CA私钥
openssl genrsa -out ca.key 2048
# 生成自签名证书
openssl req -new -x509 -sha256 -days 30 -key ca.key -out ca.crt
# 签署证书
openssl x509 -req -CA ca.crt -CAKey ca.key -in domain.csr -out domain.crt -days 30 -CAcreateserial
```

##### 密钥交换和数字信任链

### No.10 协议分析

##### 学习 HTTPS 协议

HTTPS 协议 超文本传输安全协议

HTTPS = HTTP + SSL/TLS

##### 实战分析 HTTPS TLS 协议

WIRESHARK 网络协议分析器

```shell
curl -v --tlsv1.2 --http1.1 https://110.alipay.com
```

##### 学习 SSH 协议

##### 实战分析 SSH 协议

##### 安全通信的设计要素

1. 目标身份：通信双方确认身份
2. 协商密钥
3. 对称加密
4. 消息完整性

### No.11

